<!doctype html>
<html lang="ms">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>Wish-Upon-a-Star — for Fadhlin</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
      :root{
        --soft-purple:#c7b5ff; /* nama Fadhlin */
        --soft-purple-deep:#a892ff;
        --bg-deep:#0a0c1a;
        --bg-mid:#11162a;
        --accent:#ff86bf;  /* pink lembut */
        --card:#0e1224cc;
        --text:#eef0ff;
        --muted:#9aa0c8;
      }
      *{box-sizing:border-box}
      html,body{height:100%;margin:0}
      body{
        font-family:Quicksand, system-ui, Segoe UI, Arial, sans-serif;
        background:radial-gradient(120% 100% at 50% 0%, var(--bg-mid) 0%, var(--bg-deep) 60%, #070915 100%);
        color:var(--text); overflow:hidden;
        -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
      }

      /* ===== Header ===== */
      .hud{
        position:fixed; inset:0 0 auto 0; padding:14px 16px 6px; z-index:4;
        display:flex; flex-direction:column; align-items:center; gap:6px; pointer-events:none;
      }
      .title{
        pointer-events:auto;
        display:flex; flex-wrap:wrap; gap:8px; align-items:baseline; justify-content:center;
        text-align:center; margin:0;
        font-size:clamp(20px,5.6vw,40px); line-height:1.2; font-weight:700;
        text-shadow:0 2px 18px #0008;
      }
      .title .name{
        font-family:"Dancing Script", cursive; font-weight:700;
        font-size:clamp(28px,7.2vw,56px);
        color:var(--soft-purple);
        text-shadow:0 0 28px color-mix(in oklab, var(--soft-purple) 35%, transparent);
      }
      .subtitle{
        pointer-events:auto;
        margin:0; font-weight:700; color:var(--muted); font-size:13px
      }

      /* ===== Controls ===== */
      .controls{
        pointer-events:auto;
        display:flex; gap:10px; align-items:center; justify-content:center;
        margin-top:6px;
      }
      .btn{
        appearance:none; border:none; cursor:pointer; font-weight:700;
        padding:10px 14px; border-radius:999px;
        background:linear-gradient(180deg, #2a2f57, #1c2145);
        color:var(--text);
        outline:1px solid #ffffff1a; box-shadow:0 8px 22px #0008, inset 0 0 0 1px #0008;
      }
      .btn:active{ transform:translateY(1px) }
      .btn.alt{
        background:linear-gradient(180deg, #ff9dd2, #ff70bb);
        color:#1b0e19; text-shadow:0 1px 0 #fff8;
      }

      /* ===== Canvas stars ===== */
      #sky{
        position:fixed; inset:0; z-index:1; width:100%; height:100%;
        display:block; background:transparent;
      }

      /* ===== Wish bubbles ===== */
      .wish{
        position:fixed; z-index:3; max-width:min(76vw, 420px);
        background:var(--card); backdrop-filter:blur(6px);
        border:1px solid #ffffff1e; border-radius:14px; padding:10px 14px;
        box-shadow:0 12px 30px #000a, 0 0 60px #864dff22 inset;
        transform:translate(-50%, -50%) translateY(16px); opacity:0;
        will-change:transform, opacity;
        animation:pop .45s cubic-bezier(.2,.7,.2,1) forwards;
      }
      .wish b{ color:var(--soft-purple-deep) }
      @keyframes pop{
        from{ opacity:0; transform:translate(-50%,-50%) translateY(16px) scale(.96) }
        to  { opacity:1; transform:translate(-50%,-50%) translateY(0)    scale(1) }
      }
      .fadeOut{ animation:fade 1.2s ease forwards }
      @keyframes fade{ to{opacity:0; transform:translate(-50%,-50%) translateY(-8px)} }

      /* ===== Hint footer ===== */
      .footer{
        position:fixed; inset:auto 0 8px 0; z-index:2; text-align:center;
        font-size:11px; color:#a5aad9; text-shadow:0 1px 0 #000;
        opacity:.8; padding:0 10px;
      }

      /* ===== Constellation “F” (DOM dots) ===== */
      .constellation{
        position:fixed; inset:0; z-index:2; pointer-events:none;
      }
      .fstar{
        position:absolute; width:6px; height:6px; border-radius:50%;
        background:radial-gradient(circle at 35% 35%, #fff 0 35%, transparent 36%), var(--soft-purple);
        box-shadow:0 0 12px 3px color-mix(in oklab, var(--soft-purple) 70%, transparent);
        transform:translate(-50%,-50%) scale(0);
        opacity:0;
        animation:twinkleIn .6s ease forwards;
      }
      @keyframes twinkleIn{
        0%{opacity:0; transform:translate(-50%,-50%) scale(.2)}
        80%{opacity:1; transform:translate(-50%,-50%) scale(1.08)}
        100%{opacity:1; transform:translate(-50%,-50%) scale(1)}
      }
      .fstar.fade{ animation:twinkleOut 1.2s ease forwards }
      @keyframes twinkleOut{ to{opacity:0; transform:translate(-50%,-50%) scale(.85)} }

      /* Accessibility: reduce motion */
      @media (prefers-reduced-motion: reduce){
        .wish{ animation:none; opacity:1; transform:translate(-50%,-50%) }
        .fadeOut{ animation:none; opacity:1 }
        .btn:active{ transform:none }
        .fstar{ animation:none; opacity:1; transform:translate(-50%,-50%) }
        .fstar.fade{ opacity:0 }
      }
    </style>
  </head>
  <body>
    <!-- Heads-up display -->
    <div class="hud">
      <h1 class="title">
        Wish-Upon-a-Star for <span class="name">Fadhlin</span>
      </h1>
      <p class="subtitle">Tap mana-mana di langit untuk buat hajat & dapat mesej lembut. “Make a wish” → letak di tengah. ✨</p>
      <div class="controls">
        <button class="btn alt" id="wishBtn">Make a wish</button>
        <button class="btn" id="soundBtn" aria-pressed="false">Sound: Off</button>
      </div>
    </div>

    <!-- Starfield -->
    <canvas id="sky" aria-label="Night sky with twinkling stars"></canvas>
    <!-- Constellation overlay -->
    <div class="constellation" id="constLayer"></div>

    <!-- Footer hint -->
    <div class="footer">Tip: Dua jari pinch untuk zoom halaman jika nak teks lebih besar.</div>

    <script>
      /* =========================
         Starry sky + shooting stars
         ========================= */
      const canvas = document.getElementById('sky');
      const ctx = canvas.getContext('2d', { alpha:true });

      let W=0,H=0, DPR = Math.max(1, Math.min(window.devicePixelRatio||1, 2));
      function resize(){
        W = canvas.clientWidth;
        H = canvas.clientHeight;
        canvas.width = Math.floor(W * DPR);
        canvas.height= Math.floor(H * DPR);
        ctx.setTransform(DPR,0,0,DPR,0,0);
        initStars(); // re-scatter on resize
      }
      window.addEventListener('resize', resize);

      // Stars
      let stars = [];
      function initStars(){
        const count = Math.floor((W*H)/9000); // density
        stars = new Array(count).fill(0).map(()=>({
          x: Math.random()*W,
          y: Math.random()*H,
          r: Math.random()*1.4 + 0.3,
          a: Math.random()*0.6 + 0.2,
          tw: Math.random()*0.02 + 0.005
        }));
      }

      // Shooting stars queue
      const trails = [];
      function shoot(fromX, fromY, dir = (-Math.PI/3 + (Math.random()*0.4-0.2)) ){
        const speed = 1200; // px/s
        trails.push({
          x: fromX, y: fromY,
          vx: Math.cos(dir)*speed,
          vy: Math.sin(dir)*speed,
          life: 0.6 + Math.random()*0.4, // seconds
          age: 0
        });
      }

      let last=performance.now();
      function loop(now=performance.now()){
        const dt = Math.min(0.05, (now-last)/1000); last=now;

        ctx.clearRect(0,0,W,H);

        // twinkling stars
        for(const s of stars){
          s.a += s.tw * (Math.random()>.5?1:-1);
          s.a = Math.max(.15, Math.min(.95, s.a));
          ctx.globalAlpha = s.a;
          ctx.fillStyle = '#cfd6ff';
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.r, 0, Math.PI*2);
          ctx.fill();
        }
        ctx.globalAlpha = 1;

        // trails
        for(let i=trails.length-1;i>=0;i--){
          const t = trails[i];
          t.age += dt;
          if(t.age>t.life){ trails.splice(i,1); continue; }
          const p = 1 - (t.age/t.life);

          // draw trail
          const len = 180*(p+0.2);
          const mag = Math.hypot(t.vx,t.vy)||1;
          const nx = -t.vx/mag, ny = -t.vy/mag;

          const grad = ctx.createLinearGradient(t.x, t.y, t.x+nx*len, t.y+ny*len);
          grad.addColorStop(0, 'rgba(255,255,255,0.9)');
          grad.addColorStop(1, 'rgba(199,181,255,0.0)');
          ctx.strokeStyle = grad;
          ctx.lineWidth = 2;
          ctx.beginPath();
          ctx.moveTo(t.x, t.y);
          ctx.lineTo(t.x+nx*len, t.y+ny*len);
          ctx.stroke();

          // head
          ctx.fillStyle = 'white';
          ctx.beginPath(); ctx.arc(t.x, t.y, 2.2, 0, Math.PI*2); ctx.fill();

          // integrate position
          t.x += t.vx * dt;
          t.y += t.vy * dt;
        }

        requestAnimationFrame(loop);
      }

      // Init
      resize(); requestAnimationFrame(loop);

      /* =========================
         Wishes & affirmations (BM + English)
         ========================= */
      const WISHES = [
        "Cikgu Fadhlin, penat itu tanda kamu sedang beri yang terbaik. Rehat sekejap pun usaha juga. <b>I’m always here for you.</b>",
        "Anak murid mungkin lupa bab, tapi mereka tak lupa hati cikgu. Go slow, it’s okay. <b>Saya ada, bila-bila.</b>",
        "Hari susah tak kekal. Ilmu yang Fadhlin tanam kekal lama. Kalau berat, sandar pada saya — <b>I’m here.</b>",
        "Kebaikan kecil harian cikgu akan jadi besar dalam hidup orang lain. Be gentle with yourself. <b>Saya sentiasa ada.</b>",
        "You don’t have to be perfect to be amazing. Cukup buat setakat mampu, <b>itu sudah hebat</b>.",
        "Storms pass. Langit akan cerah semula. <b>Hold on, I’ve got your back.</b>",
        "Small steps count — langkah kecil pun kemajuan. <b>Proud of you, cikgu.</b>",
        "Breathe in calm, breathe out worry. <b>Tarik nafas perlahan… lepas perlahan.</b>",
        "You’re doing your best, and that’s enough. <b>Dalam masa sama, jangan lupa rehat.</b>",
        "Cikgu, senyuman kamu ubah suasana kelas. <b>Your smile is someone’s sunshine today.</b>",
        "You are loved more than you know. Ada orang yang selalu ada untuk kamu — <b>termasuk saya.</b>",
        "Kalau rasa penat, itu normal. <b>Pause sekejap. Sambung bila sedia.</b>",
        "Kamu sabar dengar anak murid — <b>that patience matters a lot.</b>",
        "It’s okay to feel. Perasaan datang dan pergi. <b>You’re safe here.</b>",
        "Let today be soft. <b>Hari ini pelan-pelan, sayang diri dulu.</b>",
        "You’ve survived every tough day so far. <b>Esok mungkin lebih ringan.</b>",
        "Ilmu kamu memberi makna. Even on quiet days, <b>your impact remains.</b>",
        "Aku buat setakat yang mampu, dan itu sudah cukup. <b>(Read this twice.)</b>",
        "Kemajuan kecil tetap kemajuan — <b>tiny steps still steps.</b>",
        "Aku layak rehat, aku layak disayangi. <b>I deserve gentleness.</b>",
        "Aku memberi dengan ikhlas, dan aku juga menjaga diri. <b>Balance matters.</b>",
        "Kau tak berseorangan — <b>I’m always here to listen, to stay.</b>",
        "Some days are heavy; let kindness do the lifting. <b>Jadikan hari ini lembut.</b>",
        "One soft day at a time. <b>You’re doing enough, Fadhlin.</b>"
      ];

      function showWish(x,y,text){
        const div = document.createElement('div');
        div.className = 'wish';
        div.style.left = x+'px';
        div.style.top  = y+'px';
        div.innerHTML = text;
        document.body.appendChild(div);

        // auto fade after 3.8s
        setTimeout(()=> div.classList.add('fadeOut'), 3200);
        setTimeout(()=> div.remove(), 4600);
      }

      /* =========================
         Interactions + sound
         ========================= */
      let audioCtx = null;
      let soundOn = false;
      const soundBtn = document.getElementById('soundBtn');
      function pling(){
        if(!audioCtx || !soundOn) return;
        const ctx = audioCtx;
        const o = ctx.createOscillator();
        const g = ctx.createGain();

        // sparkle chord
        const tones = [659.25, 987.77, 1318.51]; // E5, B5, E6
        o.frequency.value = tones[Math.floor(Math.random()*tones.length)];
        o.type = 'sine';

        const now = ctx.currentTime;
        g.gain.setValueAtTime(0.0001, now);
        g.gain.linearRampToValueAtTime(0.16, now+0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, now+0.45);

        o.connect(g); g.connect(ctx.destination);
        o.start(now); o.stop(now+0.5);
      }

      soundBtn.addEventListener('click', ()=>{
        if(!audioCtx){ try{ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }catch(e){} }
        soundOn = !soundOn;
        soundBtn.setAttribute('aria-pressed', String(soundOn));
        soundBtn.textContent = 'Sound: ' + (soundOn ? 'On' : 'Off');
        if(soundOn) pling();
      });

      // Tap/klik pada langit
      function skyEvent(e){
        const x = e.clientX ?? (e.touches && e.touches[0].clientX);
        const y = e.clientY ?? (e.touches && e.touches[0].clientY);
        if(x==null || y==null) return;

        shoot(x, y, -Math.PI/3 + (Math.random()*0.8 - 0.4));
        const offsetY = Math.max(80, Math.min(window.innerHeight-120, y - 40));
        showWish(x, offsetY, WISHES[Math.floor(Math.random()*WISHES.length)]);
        pling();
      }
      canvas.addEventListener('pointerdown', skyEvent, {passive:true});

      // Butang "Make a wish": tengah skrin + shooting star dari atas kiri
      const wishBtn = document.getElementById('wishBtn');
      wishBtn.addEventListener('click', ()=>{
        const cx = window.innerWidth/2, cy = window.innerHeight/2;
        shoot(cx-200, cy-120, -Math.PI/4); // diagonal cantik
        showWish(cx, cy, WISHES[Math.floor(Math.random()*WISHES.length)]);
        pling();
      });

      // Prime audio on first touch (iOS)
      window.addEventListener('touchstart', ()=>{ if(!audioCtx && soundOn){ audioCtx = new (window.AudioContext||window.webkitAudioContext)(); } }, {once:true, passive:true});

      /* =========================
         NEW: Auto shooting star (10–15s), Auto “F” (25–35s)
         ========================= */
      function autoShootLoop(){
        const delay = 10000 + Math.random()*5000; // 10–15s
        setTimeout(()=>{
          const fromSide = Math.random() < 0.5;
          const sx = fromSide ? -80 : window.innerWidth + 80;
          const sy = 80 + Math.random()*(window.innerHeight*0.6);
          const dir = fromSide ? (-Math.PI/6 - Math.random()*0.5) : (Math.PI - (-Math.PI/6 - Math.random()*0.5));
          shoot(sx, sy, dir);
          if(soundOn) pling();
          autoShootLoop();
        }, delay);
      }
      autoShootLoop();

      const constLayer = document.getElementById('constLayer');
      function showFConstellation(){
        // saiz & posisi huruf F relatif ke tengah
        const cx = window.innerWidth/2;
        const cy = window.innerHeight/2 - 40;
        const scale = Math.min(window.innerWidth, window.innerHeight) * 0.18; // saiz responsif

        // Koordinat F dalam grid (unit: 1.0). Bentuk: batang vertikal + bar atas + bar tengah
        const pts = [];
        // batang vertikal (0 ≤ y ≤ 1.0, x=0)
        for(let y=0;y<=10;y++) pts.push([0, y/10]);
        // bar atas (x: 0→0.7 pada y=0)
        for(let x=0;x<=7;x++) pts.push([x/10, 0]);
        // bar tengah (x: 0→0.55 pada y=0.5)
        for(let x=0;x<=5;x++) pts.push([x/10, 0.5]);

        // tabur titik dengan animasi twinkleIn kemudian fade
        const nodes=[];
        pts.forEach((p,i)=>{
          const dot = document.createElement('div');
          dot.className = 'fstar';
          // ubah dari grid (0..1) kepada piksel, dengan sedikit jitter kecil
          const jitter = () => (Math.random()-0.5)*6;
          const x = cx + (p[0]-0.05)*scale + jitter();
          const y = cy + (p[1]-0.05)*scale + jitter();
          dot.style.left = x+'px';
          dot.style.top  = y+'px';
          dot.style.animationDelay = (i*20)+'ms';
          constLayer.appendChild(dot);
          nodes.push(dot);
        });

        // tembak satu shooting star melintasi F
        shoot(cx- scale*0.6, cy- scale*0.4, -Math.PI/4);
        if(soundOn) pling();

        // kekalkan 2.8s, kemudian fade & buang
        setTimeout(()=> nodes.forEach(n=> n.classList.add('fade')), 2800);
        setTimeout(()=> nodes.forEach(n=> n.remove()), 4200);
      }

      function autoFLoop(){
        const delay = 25000 + Math.random()*10000; // 25–35s
        setTimeout(()=>{
          showFConstellation();
          autoFLoop();
        }, delay);
      }
      autoFLoop();
    </script>
  </body>
</html>
